# dev/peer/dependencies 

本文主要介绍 `devDependencies`、`peerDependencies` 和 `dependencies` 的使用场景及区别

## 介绍

### dependencies

生产环境依赖，该项目使用 `npm install` 安装时，**会安装**该依赖项里所有的包。若当前库为第三方sdk包时，宿主安装时会考虑该依赖项，
若宿主没有依赖项里的包时，会默认安装；若宿主有该依赖包且版本较低时，会在第三方sdk内部默认安装其依赖的版本；
若宿主有该依赖包且版本大于等于时，第三方sdk会默认使用宿主端（前提第三方sdk依赖包有 ^）

### devDependencies

开发环境依赖, 该项目使用 `npm install` 安装时，**会安装**该依赖项里所有的包。若当前库为第三方sdk包时，宿主安装时不会考虑该依赖项

### peerDependencies

第三方库依赖，该项目使用 `npm install` 安装时，**不会安装**该依赖项里所有的包。若当前库为第三方sdk包时，宿主安装会考虑该依赖项，
若宿主没有依赖项里的包时，会报错提示。

## 对比

| 名称 | 开发时是否安装 | 三方库时是否安装 | 宿主端无依赖时 | 宿主端有依赖且版本高于 | 宿主端有依赖且版本低于 |
| -- | -- | -- | -- | -- | -- |
| dependencies | 是 | 是 | 安装到宿主内 | 不安装使用宿主安装依赖 | 内部安装本身依赖的版本 |
| devDependencies | 是 | 否 | - | - | - |
| peerDependencies | 否 | 否 | 报错提示 | 无提示 | 无提示 |


## NPM v7

在 `NPM v7` 版本中, 默认安装 `peerDependencies` 的依赖，可以使用 `–legacy-peer-deps` 标志阻止peer依赖的安装。


## semver 介绍

semver 是 语义化版本（Semantic Versioning）规范 的一个实现，目前是由 npm 的团队维护，实现了版本和版本范围的解析、计算、比较。


### 两个概念

**固定版本**：是指例如 0.4.1、1.2.7、1.2.4-beta.0 这样表示包的特定版本的字符串。

**范围版本**：是对满足特定规则的版本的一种表示，例如 1.2.3-2.3.4、1.x、^0.2、>1.4.

### 版本号格式

主版本号[MAJOR]、次版本号[MINOR]、修订号[PATCH]

1. 主版本号：当做了不兼容的 API 修改，
2. 次版本号：当做了向下兼容的功能性新增，
3. 修订号：当做了向下兼容的问题修正。

### 先行版本号（Pre-release Version）

先行版本号可以作为发布正式版之前的版本，格式是在修订版本号后面加上一个连接号（-），再加上一连串以点（.）分割的标识符，标识符可以由英文、数字和连接号（[0-9A-Za-z-]）组成.

```js
1.0​​.0-alpha
1.0.0-alpha.1
1.0.0-0.3.7
1.0.0-x.7.z.92
```

1. alpha：是内部测试版,一般不向外部发布,会有很多Bug.一般只有测试人员使用。
2. beta：也是测试版，这个阶段的版本会一直加入新的功能。在Alpha版之后推出
3. rc：Release　Candidate) 系统平台上就是发行候选版本。RC版不会再加入新的功能了，主要着重于除错。


### 定义依赖版本号

在 npm 的依赖的规则中，还有 ~、>、<、=、>=、<=、-、||、x、X、* 等符号；当使用 `npm install` 时，被安装的依赖的版本号前会默认加上 ^ 符号。

1. `^` 表示同一主版本号中，不小于指定版本号的版本号

```js
 `^2.2.1` 对应主版本号为 2，不小于 `2.2.1` 的版本号，比如 `2.2.1`、`2.2.2`、`2.3.0` ,主版本号固定
// 当该依赖有最新版本时(eg:2.3.3)，npm install 会安装最新的依赖
```

2. `~` 表示同一主版本号和次版本号中，不小于指定版本号的版本号

```js
 `~2.2.1` 对应主版本号为 2，次版本号为 2，不小于 `2.2.1` 的版本号，比如 `2.2.1、2.2.2`，主版本号和次版本号固定
```

3. `>、<、=、>=、<=、-` 表示用来指定一个版本号范围

```js
 `>2.1`
 `1.0.0 - 1.2.0`
//注意使用 `-` 的时候，必须两边都有空格。
```

4. `||` 表示或

```js
 `^2 <2.2 || > 2.3`
```

5. `x、X、*` 表示通配符

```js
 `*` 对应所有版本号
 `3.x` 对应所有主版本号为 3 的版本号
```

## 链接

[semver](https://semver.org/lang/zh-CN/)